#!/usr/bin/env bqn

# Reference: https://github.com/codereport/bqn-format/blob/main/bqn-format
_AdjMap   â‡ {Â¯1âŠ¸â†“ğ”½1âŠ¸â†“}
_ChunkKey â‡ {(0âˆ¾+`Differğ”½Â¨ğ•©)âŠ”ğ•©}
Differ â‡ â‰  _AdjMap

Asm â† {Â¬(â‰ `âŠ¸âˆ¨)"'"""âˆŠËœğ•©} # anti string mask # TODO fix
Ca  â† {(âˆ¨Â´(Asmâˆ§'#'âŠ¸=)ğ•©)âˆ§âˆ¨Â´' 'â‰ (âˆ§`(Asmâˆ§'#'âŠ¸â‰ ))âŠ¸/ğ•©}             # comment alignable

SplitMask â‡ {âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/ğ•©âŠ”Ëœ1-Ëœ(Â¬âˆ§1++`)ğ•¨}
Join      â‡ { 0=â‰ ğ•© ? ğ•© ; (âŠ£âˆ¾ğ•¨âˆ¾âŠ¢)Â´ğ•© }
Trim      â‡ (Â¬Â·(âˆ§`âŒ¾âŒ½âˆ¨âˆ§`)' '=âŠ¢)âŠ¸/


Align â† { wğ•Šğ•©:
    Sma â† (Asmâˆ§âˆŠâŸœw)âŠ¸SplitMask  # split mask with asm
    n   â† âŒˆÂ´(+Â´Â·âˆ¨`âŒ¾âŒ½' 'â‰ âŠ‘âˆ˜Sma)Â¨ğ•© # length for alignment
    {(' 'âˆ¾wâˆ¾' ')Join TrimÂ¨âŒ¾(1âŠ¸â†“)nâŠ¸â†‘âŒ¾âŠ‘Sma ğ•©}Â¨ğ•©
}

lâ†â€¢FLines "/dev/stdin"
lâ†©{(Â¬Â·âˆ§`âŒ¾âŒ½' 'âŠ¸=)âŠ¸/ğ•©}Â¨l            # remove trailing whitespace
g â† Ca _ChunkKey l               # create chunks for aligning
l â†© âˆ¾{ CaâŠ‘ğ•© ? "#" Align ğ•© â‹„ ; ğ•© }Â¨g # align # symbols
â€¢Out 1â†“âˆ¾(@+10)âŠ¸âˆ¾Â¨l
